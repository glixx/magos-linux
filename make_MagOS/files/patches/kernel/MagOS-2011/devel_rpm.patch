diff -auprN a/arch/um/scripts/Makefile.rules b/arch/um/scripts/Makefile.rules
--- a/arch/um/scripts/Makefile.rules	1970-01-01 03:00:00.000000000 +0300
+++ b/arch/um/scripts/Makefile.rules	2011-10-28 14:15:11.000000000 +0400
@@ -0,0 +1,32 @@
+# ===========================================================================
+# arch/um: Generic definitions
+# ===========================================================================
+
+USER_SINGLE_OBJS := \
+	$(foreach f,$(patsubst %.o,%,$(obj-y) $(obj-m)),$($(f)-objs))
+USER_OBJS += $(filter %_user.o,$(obj-y) $(obj-m)  $(USER_SINGLE_OBJS))
+USER_OBJS := $(foreach file,$(USER_OBJS),$(obj)/$(file))
+
+$(USER_OBJS:.o=.%): \
+	c_flags = -Wp,-MD,$(depfile) $(USER_CFLAGS) $(CFLAGS_$(basetarget).o)
+$(USER_OBJS) : CHECKFLAGS := -D__linux__ -Dlinux -D__STDC__ \
+	-Dunix -D__unix__ -D__$(SUBARCH)__ $(CF)
+
+# These are like USER_OBJS but filter USER_CFLAGS through unprofile instead of
+# using it directly.
+UNPROFILE_OBJS := $(foreach file,$(UNPROFILE_OBJS),$(obj)/$(file))
+
+$(UNPROFILE_OBJS:.o=.%): \
+	c_flags = -Wp,-MD,$(depfile) $(call unprofile,$(USER_CFLAGS)) $(CFLAGS_$(basetarget).o)
+$(UNPROFILE_OBJS) : CHECKFLAGS := -D__linux__ -Dlinux -D__STDC__ \
+	-Dunix -D__unix__ -D__$(SUBARCH)__ $(CF)
+
+# The stubs can't try to call mcount or update basic block data
+define unprofile
+	$(patsubst -pg,,$(patsubst -fprofile-arcs -ftest-coverage,,$(1)))
+endef
+
+ifdef subarch-obj-y
+obj-y += subarch.o
+subarch-y = $(addprefix ../../$(HEADER_ARCH)/,$(subarch-obj-y))
+endif
diff -auprN a/develfiles.list b/develfiles.list
--- a/develfiles.list	2011-11-03 14:52:53.000000000 +0400
+++ b/develfiles.list	2011-12-24 13:18:58.538001130 +0400
@@ -3953,3 +3953,30 @@ System.map
 include/config/
 include/generated/
 scripts/
+drivers/lguest/lg.h
+Documentation/laptops/Makefile
+Documentation/networking/Makefile
+Documentation/networking/timestamping/Makefile
+Documentation/accounting/Makefile
+Documentation/Makefile
+Documentation/cdrom/Makefile
+Documentation/spi/Makefile
+Documentation/connector/Makefile
+Documentation/watchdog/src/Makefile
+Documentation/DocBook/Makefile
+Documentation/timers/Makefile
+Documentation/blackfin/Makefile
+Documentation/filesystems/Makefile
+Documentation/filesystems/configfs/Makefile
+Documentation/pcmcia/Makefile
+Documentation/arm/SH-Mobile/Makefile
+Documentation/lguest/Makefile
+Documentation/vm/Makefile
+Documentation/ia64/Makefile
+Documentation/auxdisplay/Makefile
+include/linux/aufs_type.h
+fs/aufs/Makefile
+fs/aufs/magic.mk
+fs/aufs/Kconfig
+fs/aufs/conf.mk
+arch/um/scripts/Makefile.rules
